<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>KF Pizzaria & Tapiocaria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>KF Pizzaria & Tapiocaria</h1>
</header>

<main>

  <!-- CARDÃPIO (EXEMPLO â€“ mantenha o seu se jÃ¡ existir) -->
  <section id="cardapio">
    <button onclick="adicionarItem('Pizza Mussarela', 30)">Pizza Mussarela - R$30</button>
    <button onclick="adicionarItem('Pizza Calabresa', 35)">Pizza Calabresa - R$35</button>
  </section>

  <!-- CARRINHO -->
  <section id="carrinho">
    <h3>ğŸ›’ Seu Pedido</h3>
    <div id="listaCarrinho"></div>
    <p><strong>Total:</strong> R$ <span id="total">0.00</span></p>
  </section>

  <!-- DADOS DO CLIENTE -->
  <section id="dados">
    <input type="text" id="nome" placeholder="Seu nome">
    <input type="text" id="endereco" placeholder="EndereÃ§o completo">
    
    <select id="pagamento">
      <option value="">Forma de pagamento</option>
      <option value="Dinheiro">Dinheiro</option>
      <option value="CartÃ£o">CartÃ£o</option>
      <option value="Pix">Pix</option>
    </select>

    <input type="text" id="troco" placeholder="Troco para quanto? (se dinheiro)">
    <textarea id="observacao" placeholder="ObservaÃ§Ãµes"></textarea>

    <button onclick="finalizarPedido()">ğŸ“² Finalizar Pedido</button>
  </section>

</main>

<!-- FIREBASE -->
<script src="firebase.js"></script>

<script>
  let carrinho = [];
  let total = 0;

  function adicionarItem(nome, preco){
    const item = carrinho.find(i => i.nome === nome);

    if(item){
      item.quantidade++;
    } else {
      carrinho.push({ nome, preco, quantidade: 1 });
    }

    atualizarCarrinho();
  }

  function atualizarCarrinho(){
    const lista = document.getElementById("listaCarrinho");
    const totalSpan = document.getElementById("total");

    lista.innerHTML = "";
    total = 0;

    carrinho.forEach(item => {
      total += item.preco * item.quantidade;
      lista.innerHTML += `<p>${item.nome} x${item.quantidade}</p>`;
    });

    totalSpan.textContent = total.toFixed(2);
  }

  function finalizarPedido(){
    const nome = document.getElementById("nome").value.trim();
    const endereco = document.getElementById("endereco").value.trim();
    const pagamento = document.getElementById("pagamento").value;
    const troco = document.getElementById("troco").value.trim();
    const observacao = document.getElementById("observacao").value.trim();

    if(!nome || !endereco || !pagamento || carrinho.length === 0){
      alert("Preencha todos os dados e adicione itens.");
      return;
    }

    const mapa = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(endereco)}`;

    const itensTexto = carrinho
      .map(i => `- ${i.nome} x${i.quantidade}`)
      .join("\n");

    let mensagem = `ğŸ• *NOVO PEDIDO - KF PIZZARIA*
ğŸ‘¤ Nome: ${nome}
ğŸ§¾ Pedido:
${itensTexto}
ğŸ“ EndereÃ§o: ${endereco}
ğŸŒ Mapa: ${mapa}
ğŸ’³ Pagamento: ${pagamento}
ğŸ’° Total: R$ ${total.toFixed(2)}`;

    if(observacao){
      mensagem += `\nğŸ“ ObservaÃ§Ã£o: ${observacao}`;
    }

    // ENVIA PARA WHATSAPP
    window.open(
      `https://wa.me/5521997437285?text=${encodeURIComponent(mensagem)}`,
      "_blank"
    );

    // SALVA NO FIREBASE
    db.collection("pedidos").add({
      nome,
      endereco,
      pagamento,
      troco: troco || "",
      observacao,
      itens: carrinho,
      total,
      status: "Pendente",
      criadoEm: new Date()
    });

    carrinho = [];
    atualizarCarrinho();
    alert("Pedido enviado com sucesso!");
  }
</script>

</body>
</html>
